version: "3.7"
services:
  site:
    build:
      context: .
      target: flaskapp
    restart: unless-stopped
    ports:
      - "7331:7331"
    volumes:
      - ${PWD}/settings.json:/app/settings.json
      - ${PWD}/logs/:/app/logs/
    environment:
      - TZ=Europe/Stockholm
    healthcheck:
      test: curl --fail -s http://localhost:7331/API/HEALTH || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
  bot:
    build:
      context: .
      target: discordbot
    restart: unless-stopped
    volumes:
      - ${PWD}/settings.json:/app/settings.json
      - ${PWD}/users.json:/app/users.json
      - ${PWD}/logs/:/app/logs/
    environment:
      - TZ=Europe/Stockholm
